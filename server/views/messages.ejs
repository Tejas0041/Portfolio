<%- include('partials/header') %>
<%- include('partials/sidebar') %>

<main class="lg:ml-64 p-4 sm:p-6 lg:p-8 pt-16 lg:pt-8">
  <h1 class="text-2xl sm:text-3xl font-bold mb-6 sm:mb-8">Contact Messages</h1>
  
  <div class="space-y-4">
    <% if (messages.length === 0) { %>
      <div class="bg-dark-200 p-8 rounded-xl text-center text-gray-400">
        No messages yet
      </div>
    <% } %>
    <% messages.forEach(msg => { %>
      <div class="bg-dark-200 p-4 sm:p-6 rounded-xl <%= !msg.read ? 'border-l-4 border-primary' : '' %>">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3 mb-4">
          <div>
            <div class="flex items-center gap-2 flex-wrap">
              <h3 class="font-semibold text-base sm:text-lg"><%= msg.name %></h3>
              <% if (!msg.read) { %>
                <span class="px-2 py-1 text-xs rounded bg-primary/20 text-primary">New</span>
              <% } %>
            </div>
            <p class="text-gray-400 text-xs sm:text-sm break-all"><%= msg.email %></p>
            <p class="text-gray-500 text-xs mt-1"><%= new Date(msg.createdAt).toLocaleString() %></p>
          </div>
          <div class="flex gap-2 flex-wrap">
            <% if (!msg.read) { %>
              <form action="/admin/messages/<%= msg._id %>/read" method="POST">
                <button type="submit" class="px-3 py-1 bg-green-500/20 text-green-400 rounded hover:bg-green-500/30 text-xs sm:text-sm">
                  Mark Read
                </button>
              </form>
            <% } %>
            <button type="button" onclick="confirmDelete('/admin/messages/<%= msg._id %>/delete', 'message')" class="px-3 py-1 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 text-xs sm:text-sm">
              Delete
            </button>
          </div>
        </div>
        <h4 class="font-medium text-white mb-2 text-sm sm:text-base"><%= msg.subject %></h4>
        <p class="text-gray-400 text-sm"><%= msg.message %></p>
        <a href="mailto:<%= msg.email %>" class="inline-block mt-4 text-primary hover:underline text-xs sm:text-sm">
          Reply via Email â†’
        </a>
      </div>
    <% }) %>
  </div>
</main>

<script>
  function confirmDelete(url, type) {
    showConfirmModal(
      'Confirm Deletion',
      `Are you sure you want to delete this ${type}? This action cannot be undone.`,
      () => {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = url;
        document.body.appendChild(form);
        form.submit();
      },
      'Delete',
      'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700'
    );
  }
</script>

<%- include('partials/footer') %>
